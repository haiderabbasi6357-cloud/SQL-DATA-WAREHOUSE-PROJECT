INSERT INTO silver.crm_cust_info (
cst_id,
cst_key,
cst_firstname,
cst_lastname,
cst_marital_status,
cst_gndr,
cst_create_date)

SELECT 
        [cst_id]
      ,[cst_key]
      ,TRIM(cst_firstname) AS cst_firstname
      ,TRIM(cst_lastname) AS  cst_lastname
      ,CASE
      WHEN UPPER(TRIM(cst_material_status)) ='S' THEN 'SINGLE'
      WHEN UPPER(TRIM(cst_material_status)) ='M' THEN 'MARRIED'
      ELSE 'UNKNOWN'
      END AS cst_material_status
      ,
      CASE
      WHEN UPPER(TRIM(cst_gndt)) ='M' THEN 'MALE'
      WHEN UPPER(TRIM(cst_gndt)) ='F' THEN 'FEMALE'
      ELSE 'UNKNOWN'
      END AS cst_gnt
      ,[cst_create_date]
FROM
(
SELECT *,
ROW_NUMBER() OVER(PARTITION BY cst_id ORDER BY cst_create_date DESC) AS FLAG_ID
FROM bronze.crm_cust_info
)T 
WHERE FLAG_ID = 1 

