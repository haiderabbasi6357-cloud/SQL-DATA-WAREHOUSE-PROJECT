INSERT INTO silver.crm_prd_info

(
prd_id,
cat_id,
prd_key,
prd_nm,
prd_cost,
prd_line,
prd_start_dt,
prd_end_date
)

SELECT 
       prd_id
       ,REPLACE(SUBSTRING(prd_key,1,5),'-','_') AS cat_id,
        SUBSTRING(prd_key,7,LEN(prd_key)) AS prd_key
      , prd_nm
      , ISNULL(prd_cost,0) AS prd_cost
      ,  CASE
      WHEN TRIM(prd_line) = 'M' THEN 'Mountain'
      WHEN TRIM(prd_line) = 'R' THEN 'Road'
      WHEN TRIM(prd_line) = 'S' THEN 'Other Sales'
      WHEN TRIM(prd_line) = 'T' THEN 'Touring'
      ELSE 'UNKNOW'
      END AS prd_line
      , CAST(prd_start as Date) AS prd_start_dt
      , CAST(LEAD(prd_start) OVER(PARTITION BY prd_key ORDER BY prd_start) AS DATE)  AS prd_end_date

  FROM bronze.crm_prd_info

 
